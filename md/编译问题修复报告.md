# Day3 ç¼–è¯‘é—®é¢˜ä¿®å¤æ€»ç»“

## é—®é¢˜è¯Šæ–­

ç¼–è¯‘æ—¶å‡ºç°çš„é”™è¯¯ï¼š
- `æ‰¾ä¸åˆ°ç¬¦å·: PathValidator` - PathValidator ç±»æœªè¢«æ‰¾åˆ°
- `æ‰¾ä¸åˆ°ç¬¦å·: Path` - java.nio.file.Path æœªè¢«å¯¼å…¥
- `æ‰¾ä¸åˆ°ç¬¦å·: Files` - java.nio.file.Files æœªè¢«å¯¼å…¥
- `æ‰¾ä¸åˆ°ç¬¦å·: Paths` - java.nio.file.Paths æœªè¢«å¯¼å…¥

## æ ¹æœ¬åŸå› 

1. **ç¼ºå°‘ package å£°æ˜**ï¼š`PathValidator.java` æ²¡æœ‰å£°æ˜ `package data;`ï¼Œå¯¼è‡´å®ƒå±äºé»˜è®¤åŒ…ï¼Œè€Œå…¶ä»–ç±»å±äº `data` åŒ…ï¼Œæ— æ³•è®¿é—®
2. **ç¼ºå°‘ import è¯­å¥**ï¼š`FtpServer.java` å’Œ `ClientSession.java` ç¼ºå°‘ NIO.2 ç›¸å…³çš„å¯¼å…¥
3. **ç¼ºå°‘ DataConnection ç±»**ï¼šDay3 éœ€è¦çš„æ–°ç±»æ–‡ä»¶ä¸å­˜åœ¨

## è§£å†³æ–¹æ¡ˆ

### 1. ä¿®å¤ PathValidator.java
æ·»åŠ äº† `package data;` å£°æ˜ï¼š
```java
package data;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
```

### 2. ä¿®å¤ FtpServer.java
æ·»åŠ äº†ç¼ºå¤±çš„ NIO.2 å¯¼å…¥ï¼š
```java
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
```

### 3. ä¿®å¤ ClientSession.java
æ·»åŠ äº†ç¼ºå¤±çš„å¯¼å…¥å’Œæ–°çš„æˆå‘˜å˜é‡ï¼š
```java
import java.net.InetSocketAddress;
import java.nio.file.DirectoryStream;
import java.nio.file.Files;
import java.nio.file.Path;
```

å¹¶æ·»åŠ äº†ï¼š
- æˆå‘˜å˜é‡ï¼š`private InetSocketAddress dataAddress = null;`
- PORT å‘½ä»¤å¤„ç†å‡½æ•°ï¼š`handlePort(String arg)`
- LIST å‘½ä»¤å¤„ç†å‡½æ•°ï¼š`handleList()`
- åœ¨ switch è¯­å¥ä¸­æ·»åŠ äº† PORT å’Œ LIST çš„ case åˆ†æ”¯

### 4. æ–°å¢ DataConnection.java
åˆ›å»ºäº†å®Œæ•´çš„æ•°æ®è¿æ¥å·¥å…·ç±»ï¼ŒåŒ…å«ï¼š
- `connect(InetSocketAddress)` - è¿æ¥åˆ°å®¢æˆ·ç«¯æ•°æ®ç«¯å£
- `sendText(String)` - å‘é€æ–‡æœ¬æ•°æ®ï¼ˆç”¨äº LISTï¼‰
- `sendBytes(byte[])` - å‘é€äºŒè¿›åˆ¶æ•°æ®ï¼ˆç”¨äº RETRï¼‰
- `read(byte[])` - è¯»å–æ•°æ®ï¼ˆç”¨äº STORï¼‰
- `close()` - å…³é—­è¿æ¥
- `isConnected()` - æ£€æŸ¥è¿æ¥çŠ¶æ€

### 5. æ–°å¢ SimpleFtpClient.java
åˆ›å»ºäº†æµ‹è¯•å®¢æˆ·ç«¯ï¼Œç”¨äºéªŒè¯ï¼š
- USER/PASS ç™»å½•
- PORT å‘½ä»¤
- LIST å‘½ä»¤
- CWD å‘½ä»¤å¯¼èˆª
- å¤šä¸ªç›®å½•çš„åˆ—è¡¨æ“ä½œ

## ç¼–è¯‘ç»“æœ

âœ… **ç¼–è¯‘æˆåŠŸï¼** æ‰€æœ‰æºæ–‡ä»¶å·²æ­£ç¡®ç¼–è¯‘åˆ° `bin/data/` ç›®å½•

```powershell
cd "c:\Users\Sept_thirteen\Desktop\è®¡ç®—æœºç½‘ç»œè¯¾è®¾\åŸºäºsocket çš„FTPè®¾è®¡ä¸å®ç°\bin"
javac -d . -encoding UTF-8 ..\src\*.java
# æ— é”™è¯¯è¾“å‡º = ç¼–è¯‘æˆåŠŸ
```

## å·²éªŒè¯åŠŸèƒ½

âœ… FtpServer å¯åŠ¨æˆåŠŸ
âœ… PathValidator åˆå§‹åŒ–æ­£å¸¸
âœ… æ ¹ç›®å½•è®¾ç½®åˆ° `data` æ–‡ä»¶å¤¹
âœ… çº¿ç¨‹æ± åˆ›å»ºæˆåŠŸ
âœ… ç›‘å¬ 2121 ç«¯å£æˆåŠŸ

## æµ‹è¯•å®¢æˆ·ç«¯çš„ä½¿ç”¨æ–¹å¼

éœ€è¦**ä¸¤ä¸ªç‹¬ç«‹çš„ç»ˆç«¯çª—å£**ï¼š

**ç»ˆç«¯ 1 - å¯åŠ¨æœåŠ¡å™¨ï¼š**
```powershell
cd "c:\Users\Sept_thirteen\Desktop\è®¡ç®—æœºç½‘ç»œè¯¾è®¾\åŸºäºsocket çš„FTPè®¾è®¡ä¸å®ç°\bin"
java data.FtpServer
```

**ç»ˆç«¯ 2 - è¿è¡Œæµ‹è¯•å®¢æˆ·ç«¯ï¼š**
```powershell
cd "c:\Users\Sept_thirteen\Desktop\è®¡ç®—æœºç½‘ç»œè¯¾è®¾\åŸºäºsocket çš„FTPè®¾è®¡ä¸å®ç°\bin"
java data.SimpleFtpClient
```

## å…³é”® Java æ¦‚å¿µè¡¥å……

### Packageï¼ˆåŒ…ï¼‰
- ç”¨é€”ï¼šç»„ç»‡ç±»æ–‡ä»¶ï¼Œé¿å…å‘½åå†²çª
- æ‰€æœ‰åŒä¸€åŒ…å†…çš„ç±»å¿…é¡»å£°æ˜ç›¸åŒçš„ `package` æŒ‡ä»¤
- å½“é€šè¿‡ç¼–è¯‘å™¨çš„ `-d` é€‰é¡¹æŒ‡å®šè¾“å‡ºç›®å½•æ—¶ï¼ŒåŒ…ä¼šè‡ªåŠ¨åˆ›å»ºå¯¹åº”çš„ç›®å½•ç»“æ„
- åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œæ‰€æœ‰ç±»éƒ½å±äº `data` åŒ…ï¼Œç¼–è¯‘åå­˜æ”¾åœ¨ `bin/data/` ä¸‹

### Importï¼ˆå¯¼å…¥ï¼‰
- ç”¨é€”ï¼šåœ¨å½“å‰ç±»ä¸­å¼•ç”¨å…¶ä»–åŒ…æˆ–ç±»
- è¯­æ³•ï¼š`import åŒ…å.ç±»å;` æˆ– `import åŒ…å.*;`
- å¸¸ç”¨çš„ NIO.2 å¯¼å…¥ï¼š
  - `java.nio.file.Path` - è·¯å¾„å¯¹è±¡
  - `java.nio.file.Files` - æ–‡ä»¶æ“ä½œå·¥å…·
  - `java.nio.file.Paths` - åˆ›å»º Path çš„å·¥å‚ç±»
  - `java.nio.file.DirectoryStream` - ç›®å½•æµéå†

### æ•°æ®è¿æ¥çš„å·¥ä½œæµç¨‹
1. å®¢æˆ·ç«¯å‘é€ `PORT h1,h2,h3,h4,p1,p2` å‘ŠçŸ¥æœåŠ¡å™¨æ•°æ®ç«¯å£
2. æœåŠ¡å™¨è®°å½•å®¢æˆ·ç«¯çš„æ•°æ®åœ°å€ `InetSocketAddress`
3. å®¢æˆ·ç«¯å‘é€ `LIST` å‘½ä»¤
4. æœåŠ¡å™¨åˆ›å»º `DataConnection` å¯¹è±¡ï¼Œä¸»åŠ¨è¿æ¥åˆ°å®¢æˆ·ç«¯
5. é€šè¿‡æ•°æ®è¿æ¥å‘é€ç›®å½•åˆ—è¡¨
6. å…³é—­æ•°æ®è¿æ¥
7. å‘é€ 226 å“åº”ç 

## ä¸‹ä¸€æ­¥

ç°åœ¨ Day3 çš„ä»£ç å·²å‡†å¤‡å¥½ï¼ä¸‹ä¸€æ­¥å¯ä»¥ï¼š

1. **éªŒè¯ PORT å’Œ LIST åŠŸèƒ½**
   - è¿è¡Œä¸¤ä¸ªç»ˆç«¯åˆ†åˆ«å¯åŠ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯
   - è§‚å¯Ÿå®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„ç›®å½•åˆ—è¡¨

2. **æµ‹è¯•ä¸åŒç›®å½•å¯¼èˆª**
   - CWD åˆ‡æ¢åˆ°å­ç›®å½•ï¼ˆå¦‚ `/public`ã€`/upload`ï¼‰
   - éªŒè¯ LIST æ˜¾ç¤ºæ­£ç¡®çš„å­ç›®å½•å†…å®¹

3. **æµ‹è¯•è·¯å¾„å®‰å…¨éªŒè¯**
   - å°è¯• `CWD ..` è¶Šæƒæ“ä½œï¼ˆåº”è¯¥å¤±è´¥ï¼‰
   - éªŒè¯å®‰å…¨æœºåˆ¶ç”Ÿæ•ˆ

4. **å‡†å¤‡ Day4 æ–‡ä»¶ä¼ è¾“åŠŸèƒ½**
   - å®ç° RETRï¼ˆä¸‹è½½ï¼‰å‘½ä»¤
   - å®ç° STORï¼ˆä¸Šä¼ ï¼‰å‘½ä»¤

## å¸¸è§é—®é¢˜

**Qï¼šä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªç»ˆç«¯ï¼Ÿ**  
Aï¼šå› ä¸ºæœåŠ¡å™¨éœ€è¦æŒç»­ç›‘å¬ç«¯å£ï¼Œæ¥å—å®¢æˆ·ç«¯è¿æ¥ã€‚å¦‚æœç”¨ä¸€ä¸ªç»ˆç«¯ï¼ŒæœåŠ¡å™¨ä¼šé˜»å¡ï¼Œæ— æ³•æ¥å—å…¶ä»–å‘½ä»¤ã€‚

**Qï¼šå¦‚ä½•åœ¨ä¸€ä¸ª PowerShell çª—å£ä¸­åŒæ—¶è¿è¡Œä¸¤ä¸ªï¼Ÿ**  
Aï¼šå¯ä»¥ç”¨ `Start-Process` å‘½ä»¤ï¼š
```powershell
Start-Process powershell -ArgumentList "cd '$PWD'; java data.FtpServer"
Start-Sleep -Seconds 2  # ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨
java data.SimpleFtpClient
```

**Qï¼šç¼–è¯‘æ—¶å‡ºç°ç¼–ç é”™è¯¯æ€ä¹ˆåŠï¼Ÿ**  
Aï¼šç¡®ä¿ä½¿ç”¨ `-encoding UTF-8` å‚æ•°ï¼Œå¹¶åœ¨ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­è®¾ç½® `JAVA_TOOL_OPTIONS=-Dfile.encoding=UTF-8`ã€‚

---

**æ‰€æœ‰ç¼–è¯‘é”™è¯¯å·²è§£å†³ï¼ŒDay3 ä»£ç å·²å‡†å¤‡å°±ç»ªï¼** ğŸ‰
